-- Initialize
getgenv().AimPart = "HumanoidRootPart"  -- Adjust to your desired aim part
getgenv().AimRadius = 30                -- The radius within which the lock can happen
getgenv().TeamCheck = false              -- Whether to check if the player is on your team
getgenv().PredictionVelocity = 8.8       -- For movement prediction

local Players = game:GetService("Players")
local Mouse = Players.LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera
local RService = game:GetService("RunService")
local Uis = game:GetService("UserInputService")

local Client = Players.LocalPlayer
local AimlockTarget = nil
local MousePressed = false
local Aimlock = true

-- Function to find the nearest target player
getgenv().GetNearestTarget = function()
    local closestPlayer = nil
    local closestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Client and player.Character then
            local char = player.Character
            local aimPart = char:FindFirstChild(getgenv().AimPart)
            if aimPart then
                local distance = (Camera.CFrame.Position - aimPart.Position).Magnitude
                if distance < closestDistance and distance <= getgenv().AimRadius then
                    closestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

-- Function to lock the camera to the target for 10 milliseconds
local function lockCamera(target)
    if target and target.Character then
        Camera.CameraSubject = target.Character:FindFirstChild(getgenv().AimPart)
        Camera.CameraType = Enum.CameraType.Attach

        -- Wait for 10 milliseconds (0.01 seconds)
        wait(0.1)

        -- Release the camera lock after 10 milliseconds
        Camera.CameraSubject = Client.Character:FindFirstChild("Humanoid")
        Camera.CameraType = Enum.CameraType.Custom
    end
end

-- Listen for the mouse button press (MouseButton1)
Uis.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end

    -- Check if the left mouse button is pressed
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        if not MousePressed then
            MousePressed = true
            local target = getgenv().GetNearestTarget()
            if target then
                AimlockTarget = target
                lockCamera(AimlockTarget)  -- Lock camera to target for 10 milliseconds
            end
        end
    end
end)

-- Reset MousePressed when mouse button is released
Uis.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        MousePressed = false
        AimlockTarget = nil
    end
end)
